# Dockerfile for astro service
FROM python:3.12-slim

# Install base requirements
RUN apt-get update && \
    apt-get install -y curl ca-certificates gnupg unzip nano jq git zsh make && \
    rm -rf /var/lib/apt/lists/*

# Install AWS CLI v2 from official source
RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip" -o "awscliv2.zip" && \
    unzip awscliv2.zip && \
    ./aws/install && \
    rm -rf awscliv2.zip aws

# Set the working directory
WORKDIR /workspace


# Install poetry and project dependencies
RUN pip install poetry
RUN pip install pipx
RUN pipx install tox --force


RUN chsh -s $(which zsh) root &&     sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" &&     git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k &&     sed -i 's/ZSH_THEME=".*"/ZSH_THEME="powerlevel10k\/powerlevel10k"/' ~/.zshrc

COPY ./zsh/.zshrc /root/.zshrc
COPY ./zsh/my_home_config.zsh /root/.oh-my-zsh/custom/my_home_config.zsh
COPY ./zsh/.p10k.zsh /root/.p10k.zsh
